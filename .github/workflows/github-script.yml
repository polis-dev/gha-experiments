on:
  push: {branches: [main]}
  workflow_dispatch:

name: github-script

concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: true

jobs:
  simple:
    runs-on: ubuntu-latest
    steps:
      - name: print contents of github.context for debugging.
        uses: actions/github-script@v6
        with: { script: 'console.log(context)' }

      - name: checkout the code.
        uses: actions/checkout@v2

      - name: import & run a local script.
        uses: actions/github-script@v6
        with:
          script: |-
            // this is the default context, provided by the github-script action.
            const ctx = { exec, core, context, io, glob, github, require, process }
            // this is the example script, which is a local file.
            const lib = await import('${{ github.workspace }}/.github/scripts/example.mjs')
            // we can now call the functions in the example script (async works!).
            lib.printStuff()
            await lib.listSSHKeysForUsername(ctx, '${{ github.actor }}')
            await lib.exampleExec(ctx)
            await lib.exampleGraphQL(ctx)
